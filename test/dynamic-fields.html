<!DOCTYPE html>
<html lang="en">  
  <head>
    <title>Modalator :: Dynamic Fields Dialog</title>
    <meta charset="utf-8"/>
    <script src="../assets/jquery-2.1.1.min.js"></script>
    <script src="../assets/bootstrap-3.3.1/js/bootstrap.min.js"></script>
    <script src="../assets/bootstrap-modal-2.2.5/js/bootstrap-modalmanager.js"></script>
    <script src="../assets/bootstrap-modal-2.2.5/js/bootstrap-modal.js"></script>
    <script src="../src/modalator-0.1/modalator.js"></script>
    <link rel="stylesheet" href="../assets/bootstrap-3.3.1/css/bootstrap.css"/>
    <link rel="stylesheet" href="../assets/bootstrap-modal-2.2.5/css/bootstrap-modal-bs3patch.css"/>
    <link rel="stylesheet" href="../assets/bootstrap-modal-2.2.5/css/bootstrap-modal.css"/>
  </head>
  <body style="margin:20px">
    <script>
      var storeKey = 'modalator-colors';
      
      // Let's suppose this is some data...
      (function() {
          localStorage.setItem(
              storeKey, JSON.stringify({
                  red:   ['#ff0000', '#cc0000', '#990000'],
                  green: ['#008000', '#006600', '#004c00'],
                  blue:  ['#0000ff', '#0000cc', '#000099']
              })
          );
      })();

      // This could also be an AJAX call...
      function getColors() {
          var stored = localStorage.getItem(storeKey);
          return stored && JSON.parse(stored) || {};
      }

      function onSelectChange() {
          $('#dialog .novalue').remove();
          $('#dialog-affirm').removeAttr('disabled');
          var current = getColors()[this.value] || [];
          var idx = Math.floor(Math.random() * current.length);
          var shade = current[idx] || '#fff';
          var query = '#dialog [name="hidden-1"]';
          var bgCol = 'background-color';
          $(query).css(bgCol, shade).val(shade).show();
      }

      function onAffirmClick() {
          $('#dialog').modal('hide');
          var colorVal = $('#dialog [name="color"]').val();
          var hiddenVal = $('#dialog [name="hidden-1"]').val();
          console.log('SUCCESS: ' + colorVal + ', ' + hiddenVal);
      }

      var launcher = Modalator.launcher.button({
          text: 'Launch Modal Dialog',
          attrs: {href: '#dialog'}
      });

      var dialog = Modalator.dialog({
          title: {text: 'Colorizer', tag: 'h3'},
          attrs: {id: 'dialog', 'data-width': 480},
          affirm: {
              attrs: {
                  id: 'dialog-affirm',
                  disabled: 'disabled',
                  onclick: onAffirmClick
              }
          },
          fields: [{
              type: 'select',
              label: {text: 'Select a Color'},
              attrs: {
                  name: 'color',
                  class: 'form-control',
                  onchange: onSelectChange
              },
              options: (function() {
                  var opts = [{
                      text: 'Select a Color',
                      attrs: {class: 'novalue', value: ''}
                  }];
                  for (var key in getColors()) {
                      opts.push({text: key, attrs: {value: key}});
                  }
                  return opts;
              })()
          }, {
              type: 'text',
              attrs: {
                  name: 'hidden-1',
                  style: 'color:#fff;display:none',
                  class: 'form-control'
              },
          }],
      });

      document.addEventListener('DOMContentLoaded', function() { 
          Modalator.appendToDOM([launcher, dialog]);
      });
    </script>
  </body>
</html>
